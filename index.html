<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ‰æ‘æ˜†ã®æ°‘æ³Šå¡¾ - æ°‘æ³Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ã‚·ãƒƒã‚¯', 'Yu Gothic', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
            background: white;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .logo {
            max-width: 400px;
            height: auto;
            margin-bottom: 20px;
        }

        .title {
            font-size: 28px;
            font-weight: bold;
            color: #d2691e;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 16px;
            color: #666;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .step {
            display: flex;
            align-items: center;
            margin: 5px;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #ddd;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 8px;
        }

        .step.active .step-number {
            background: #d2691e;
        }

        .step.completed .step-number {
            background: #28a745;
        }

        .step-text {
            font-size: 14px;
            color: #666;
        }

        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: #d2691e;
            margin-bottom: 20px;
            text-align: center;
        }

        .region-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .region-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .region-card:hover {
            border-color: #d2691e;
            transform: translateY(-2px);
        }

        .region-card.selected {
            border-color: #28a745;
            background: #f8fff8;
        }

        .region-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .region-info {
            font-size: 14px;
            color: #666;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #d2691e;
        }

        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .option-button {
            background: white;
            border: 2px solid #ddd;
            border-radius: 6px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .option-button:hover {
            border-color: #d2691e;
        }

        .option-button.selected {
            border-color: #28a745;
            background: #f8fff8;
            color: #28a745;
            font-weight: bold;
        }

        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }

        .button:hover {
            background: #0056b3;
        }

        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .button.secondary {
            background: #6c757d;
        }

        .button.secondary:hover {
            background: #545b62;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .nav-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .nav-button:hover {
            background: #545b62;
        }

        .nav-button.primary {
            background: #007bff;
        }

        .nav-button.primary:hover {
            background: #0056b3;
        }

        .nav-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .summary-table th,
        .summary-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .summary-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        .summary-table td {
            color: #666;
        }

        .completion-message {
            text-align: center;
            padding: 40px 20px;
        }

        .completion-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .completion-title {
            font-size: 28px;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 15px;
        }

        .completion-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.8;
        }

        .line-button {
            background: #00c300;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
        }

        .line-button:hover {
            background: #00a000;
        }

        .restart-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
            margin: 10px;
        }

        .restart-button:hover {
            background: #0056b3;
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px 0;
            color: #666;
            font-size: 14px;
            border-top: 1px solid #eee;
        }

        .hidden {
            display: none;
        }

        .auto-input {
            background: #e8f5e8;
            border-color: #28a745;
        }

        .market-info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .market-info h4 {
            color: #0066cc;
            margin-bottom: 10px;
        }

        .market-info p {
            font-size: 14px;
            color: #333;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .region-grid {
                grid-template-columns: 1fr;
            }

            .option-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .step-indicator {
                flex-direction: column;
                align-items: center;
            }

            .navigation {
                flex-direction: column;
                gap: 10px;
            }

            .nav-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="logo.png" alt="æœ‰æ‘æ˜†ã®æ°‘æ³Šå¡¾" class="logo" onerror="this.style.display='none'">
            <h1 class="title">æœ‰æ‘æ˜†ã®æ°‘æ³Šå¡¾</h1>
            <p class="subtitle">æ°‘æ³ŠæŠ•è³‡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</p>
        </div>

        <div class="step-indicator" id="stepIndicator">
            <!-- ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
        </div>

        <div id="app">
            <!-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯Reactã§å‹•çš„ã«ç”Ÿæˆ -->
        </div>

        <div class="footer">
            <p>&copy; 2024 æœ‰æ‘æ˜†ã®æ°‘æ³Šå¡¾. All rights reserved.</p>
        </div>
    </div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        // è¨­å®š
        const CONFIG = {
            BACKEND_URL: 'https://arikon-minpaku.onrender.com',
            LINE_URL: 'https://lin.ee/VzUHQsm'
        };

        // ãƒ‡ãƒ¼ã‚¿å®šç¾©
        const REGIONS = {
            tokyo: { name: 'æ±äº¬éƒ½', avgPrice: 8000, occupancy: 75, description: 'é«˜åç›Šã‚¨ãƒªã‚¢ã€è¦³å…‰å®¢å¤šæ•°' },
            osaka: { name: 'å¤§é˜ªåºœ', avgPrice: 6500, occupancy: 70, description: 'é–¢è¥¿ã®ä¸­å¿ƒåœ°ã€ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰äººæ°—' },
            kyoto: { name: 'äº¬éƒ½åºœ', avgPrice: 7000, occupancy: 80, description: 'è¦³å…‰åœ°ã¨ã—ã¦å®‰å®šã—ãŸéœ€è¦' },
            kanagawa: { name: 'ç¥å¥ˆå·çœŒ', avgPrice: 7500, occupancy: 65, description: 'æ±äº¬è¿‘éƒŠã€ã‚¢ã‚¯ã‚»ã‚¹è‰¯å¥½' },
            aichi: { name: 'æ„›çŸ¥çœŒ', avgPrice: 5500, occupancy: 60, description: 'ä¸­éƒ¨åœ°æ–¹ã®ä¸­å¿ƒåœ°' },
            fukuoka: { name: 'ç¦å²¡çœŒ', avgPrice: 5000, occupancy: 65, description: 'ä¹å·ã®ç„é–¢å£ã€æˆé•·ã‚¨ãƒªã‚¢' }
        };

        const OPERATION_TYPES = {
            rental: { name: 'è»¢è²¸ï¼ˆè³ƒè²¸ç‰©ä»¶ã§æ°‘æ³Šé‹å–¶ï¼‰', description: 'è³ƒè²¸ç‰©ä»¶ã‚’å€Ÿã‚Šã¦æ°‘æ³Šé‹å–¶' },
            purchase: { name: 'è³¼å…¥ï¼ˆç‰©ä»¶è³¼å…¥ã—ã¦æ°‘æ³Šé‹å–¶ï¼‰', description: 'ç‰©ä»¶ã‚’è³¼å…¥ã—ã¦æ°‘æ³Šé‹å–¶' }
        };

        const PROPERTY_TYPES = {
            '1R': { name: '1R', capacity: '1-2å', minArea: 15, maxArea: 25 },
            '1K': { name: '1K', capacity: '1-2å', minArea: 20, maxArea: 30 },
            '1DK': { name: '1DK', capacity: '2-3å', minArea: 25, maxArea: 35 },
            '1LDK': { name: '1LDK', capacity: '2-4å', minArea: 35, maxArea: 55 },
            '2K': { name: '2K', capacity: '3-4å', minArea: 35, maxArea: 50 },
            '2DK': { name: '2DK', capacity: '3-5å', minArea: 40, maxArea: 60 },
            '2LDK': { name: '2LDK', capacity: '4-6å', minArea: 50, maxArea: 80 },
            '3LDK': { name: '3LDK', capacity: '6-8å', minArea: 70, maxArea: 120 }
        };

        const MINPAKU_LAWS = {
            shinpo: { name: 'æ°‘æ³Šæ–°æ³•å¯¾å¿œ', limit: '180æ—¥åˆ¶é™ã‚ã‚Š', description: 'å¹´é–“å–¶æ¥­æ—¥æ•°180æ—¥ã¾ã§' },
            ryokan: { name: 'æ—…é¤¨æ¥­æ³•', limit: 'åˆ¶é™ãªã—', description: 'å¹´é–“å–¶æ¥­æ—¥æ•°åˆ¶é™ãªã—' },
            tokku: { name: 'ç‰¹åŒºæ°‘æ³Š', limit: 'åˆ¶é™ãªã—', description: 'å¹´é–“å–¶æ¥­æ—¥æ•°åˆ¶é™ãªã—' }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹
        let appState = {
            currentStep: 1,
            formData: {
                region: '',
                operationType: '',
                propertyType: '',
                area: '',
                customArea: '',
                capacity: '',
                minpakuLaw: '',
                monthlyRent: '',
                purchasePrice: '',
                renovationCost: '',
                deposit: '',
                keyMoney: '',
                brokerFee: '',
                vacantRent: '',
                insurance: '',
                guarantee: '',
                otherCosts: ''
            }
        };

        // ã‚¹ãƒ†ãƒƒãƒ—å®šç¾©
        function getSteps() {
            return appState.formData.operationType === 'rental' ? [
                { id: 1, title: 'åœ°åŸŸé¸æŠ' },
                { id: 2, title: 'é‹å–¶å½¢æ…‹' },
                { id: 3, title: 'ç‰©ä»¶æƒ…å ±' },
                { id: 4, title: 'åå®¹äººæ•°' },
                { id: 5, title: 'æŠ•è³‡é‡‘é¡' },
                { id: 6, title: 'åˆæœŸè²»ç”¨' },
                { id: 7, title: 'ç¢ºèªãƒ»è¨ˆç®—' }
            ] : [
                { id: 1, title: 'åœ°åŸŸé¸æŠ' },
                { id: 2, title: 'é‹å–¶å½¢æ…‹' },
                { id: 3, title: 'ç‰©ä»¶æƒ…å ±' },
                { id: 4, title: 'åå®¹äººæ•°' },
                { id: 5, title: 'æŠ•è³‡é‡‘é¡' },
                { id: 6, title: 'ç¢ºèªãƒ»è¨ˆç®—' }
            ];
        }

        // ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼æ›´æ–°
        function updateStepIndicator() {
            const indicator = document.getElementById('stepIndicator');
            if (!indicator) return;

            const steps = getSteps();
            indicator.innerHTML = steps.map(step => `
                <div class="step ${step.id === appState.currentStep ? 'active' : step.id < appState.currentStep ? 'completed' : ''}">
                    <div class="step-number">${step.id}</div>
                    <div class="step-text">${step.title}</div>
                </div>
            `).join('');
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿æ›´æ–°
        function updateFormData(field, value) {
            appState.formData[field] = value;
            
            // æœˆé¡å®¶è³ƒãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã€åˆæœŸè²»ç”¨ã‚’è‡ªå‹•è¨ˆç®—
            if (field === 'monthlyRent' && value) {
                const rent = parseInt(value);
                appState.formData.deposit = rent * 2; // æ•·é‡‘2ãƒ¶æœˆ
                appState.formData.keyMoney = rent; // ç¤¼é‡‘1ãƒ¶æœˆ
                appState.formData.brokerFee = rent; // ä»²ä»‹æ‰‹æ•°æ–™1ãƒ¶æœˆ
                appState.formData.vacantRent = rent; // ç©ºå®¶è³ƒ1ãƒ¶æœˆ
                appState.formData.insurance = 20000; // ç«ç½ä¿é™º
                appState.formData.guarantee = Math.round(rent * 0.5); // ä¿è¨¼ä¼šç¤¾0.5ãƒ¶æœˆ
                appState.formData.otherCosts = 50000; // ãã®ä»–è²»ç”¨
            }
            
            renderApp();
        }

        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
        function nextStep() {
            const steps = getSteps();
            if (appState.currentStep < steps.length) {
                appState.currentStep++;
                renderApp();
            }
        }

        function prevStep() {
            if (appState.currentStep > 1) {
                appState.currentStep--;
                renderApp();
            }
        }

        // é€²è¡Œå¯èƒ½ãƒã‚§ãƒƒã‚¯
        function canProceed() {
            const { formData, currentStep } = appState;
            switch (currentStep) {
                case 1: return formData.region;
                case 2: return formData.operationType;
                case 3: return formData.propertyType && (formData.area || formData.customArea) && formData.minpakuLaw;
                case 4: return formData.capacity;
                case 5: 
                    if (formData.operationType === 'rental') {
                        return formData.monthlyRent && formData.renovationCost;
                    } else {
                        return formData.purchasePrice && formData.renovationCost;
                    }
                case 6: 
                    if (formData.operationType === 'rental') {
                        return true; // åˆæœŸè²»ç”¨ã¯ä»»æ„
                    } else {
                        return true; // è³¼å…¥ã®å ´åˆã¯ç¢ºèªç”»é¢
                    }
                default: return true;
            }
        }

        // çµæœè¨ˆç®—
        function calculateResults() {
            const { formData } = appState;
            const region = REGIONS[formData.region];
            const area = parseInt(formData.area || formData.customArea);
            const capacity = parseInt(formData.capacity);
            const renovationCost = parseInt(formData.renovationCost) * 10000;
            
            let monthlyRevenue, totalInitialCost, monthlyProfit, roi, paybackPeriod;

            // æœˆé–“å£²ä¸Šè¨ˆç®—
            const dailyRate = region.avgPrice * capacity;
            const monthlyOccupancy = region.occupancy / 100;
            const operatingDays = formData.minpakuLaw === 'shinpo' ? 15 : 30; // æœˆé–“å–¶æ¥­æ—¥æ•°
            monthlyRevenue = dailyRate * operatingDays * monthlyOccupancy;

            // æœˆé–“çµŒè²»
            const monthlyExpenses = formData.operationType === 'rental' 
                ? parseInt(formData.monthlyRent || 0) + 30000 // å®¶è³ƒ + ç®¡ç†è²»ç­‰
                : 50000; // è³¼å…¥ã®å ´åˆã¯ç®¡ç†è²»ç­‰ã®ã¿

            // åˆæœŸè²»ç”¨è¨ˆç®—
            if (formData.operationType === 'rental') {
                const deposit = parseInt(formData.deposit || 0);
                const keyMoney = parseInt(formData.keyMoney || 0);
                const brokerFee = parseInt(formData.brokerFee || 0);
                const vacantRent = parseInt(formData.vacantRent || 0);
                const insurance = parseInt(formData.insurance || 0);
                const guarantee = parseInt(formData.guarantee || 0);
                const otherCosts = parseInt(formData.otherCosts || 0);
                
                totalInitialCost = renovationCost + deposit + keyMoney + brokerFee + vacantRent + insurance + guarantee + otherCosts;
            } else {
                const purchasePrice = parseInt(formData.purchasePrice) * 10000;
                totalInitialCost = purchasePrice + renovationCost;
            }

            monthlyProfit = monthlyRevenue - monthlyExpenses;
            roi = (monthlyProfit * 12 / totalInitialCost) * 100;
            paybackPeriod = totalInitialCost / monthlyProfit;

            // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            const results = {
                region: region.name,
                operationType: OPERATION_TYPES[formData.operationType].name,
                propertyType: formData.propertyType,
                area: area,
                capacity: capacity,
                minpakuLaw: MINPAKU_LAWS[formData.minpakuLaw].name,
                monthlyRevenue: Math.round(monthlyRevenue),
                monthlyExpenses: monthlyExpenses,
                monthlyProfit: Math.round(monthlyProfit),
                totalInitialCost: totalInitialCost,
                roi: Math.round(roi * 10) / 10,
                paybackPeriod: Math.round(paybackPeriod * 10) / 10,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('minpakuSimulationResults', JSON.stringify(results));
            
            // LINE Botç”¨ã®Webhookã‚’é€ä¿¡
            sendToLineBot(results);
            
            appState.currentStep = getSteps().length + 1; // å®Œäº†ç”»é¢ã¸
            renderApp();
        }

        // LINE Botç”¨ã®Webhooké€ä¿¡
        function sendToLineBot(results) {
            // ç°¡æ˜“çš„ãªLINE Botæ©Ÿèƒ½ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            const resultMessage = `
ğŸ  æ°‘æ³Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ

ğŸ“ åœ°åŸŸ: ${results.region}
ğŸ¢ é‹å–¶å½¢æ…‹: ${results.operationType}
ğŸ  ç‰©ä»¶: ${results.propertyType} (${results.area}ã¡)
ğŸ‘¥ åå®¹äººæ•°: ${results.capacity}å
ğŸ“‹ æ°‘æ³Šæ³•: ${results.minpakuLaw}

ğŸ’° åç›Šäºˆæ¸¬:
ãƒ»æœˆé–“å£²ä¸Š: Â¥${results.monthlyRevenue.toLocaleString()}
ãƒ»æœˆé–“çµŒè²»: Â¥${results.monthlyExpenses.toLocaleString()}
ãƒ»æœˆé–“åˆ©ç›Š: Â¥${results.monthlyProfit.toLocaleString()}

ğŸ“Š æŠ•è³‡æŒ‡æ¨™:
ãƒ»åˆæœŸæŠ•è³‡: Â¥${results.totalInitialCost.toLocaleString()}
ãƒ»ROI: ${results.roi}%
ãƒ»æŠ•è³‡å›åæœŸé–“: ${results.paybackPeriod}ãƒ¶æœˆ

â€» ã“ã®çµæœã¯æ¦‚ç®—ã§ã™ã€‚å®Ÿéš›ã®åç›Šã¯å¸‚å ´çŠ¶æ³ã«ã‚ˆã‚Šå¤‰å‹•ã—ã¾ã™ã€‚
            `;
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«LINE Botç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜
            localStorage.setItem('lineBotMessage', resultMessage);
            
            // å®Ÿéš›ã®LINE Bot APIã¸ã®é€ä¿¡ï¼ˆå°†æ¥ã®å®Ÿè£…ç”¨ï¼‰
            try {
                fetch(CONFIG.BACKEND_URL + '/webhook', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: 'simulation_result',
                        data: results
                    })
                }).catch(err => console.log('Backend not available:', err));
            } catch (err) {
                console.log('Backend not available:', err);
            }
        }

        // ã‚¢ãƒ—ãƒªå†é–‹
        function restart() {
            appState.currentStep = 1;
            appState.formData = {
                region: '',
                operationType: '',
                propertyType: '',
                area: '',
                customArea: '',
                capacity: '',
                minpakuLaw: '',
                monthlyRent: '',
                purchasePrice: '',
                renovationCost: '',
                deposit: '',
                keyMoney: '',
                brokerFee: '',
                vacantRent: '',
                insurance: '',
                guarantee: '',
                otherCosts: ''
            };
            renderApp();
        }

        // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°
        function renderApp() {
            updateStepIndicator();
            
            const appElement = document.getElementById('app');
            if (!appElement) return;

            let content = '';
            
            switch (appState.currentStep) {
                case 1:
                    content = renderRegionSelection();
                    break;
                case 2:
                    content = renderOperationTypeSelection();
                    break;
                case 3:
                    content = renderPropertyInfo();
                    break;
                case 4:
                    content = renderCapacitySelection();
                    break;
                case 5:
                    content = renderInvestmentAmount();
                    break;
                case 6:
                    if (appState.formData.operationType === 'rental') {
                        content = renderInitialCosts();
                    } else {
                        content = renderConfirmation();
                    }
                    break;
                case 7:
                    content = renderConfirmation();
                    break;
                default:
                    content = renderCompletion();
                    break;
            }
            
            appElement.innerHTML = content;
        }

        // å„ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°
        function renderRegionSelection() {
            return `
                <div class="form-section">
                    <h2 class="section-title">åœ°åŸŸã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
                    <div class="region-grid">
                        ${Object.entries(REGIONS).map(([key, region]) => `
                            <div class="region-card ${appState.formData.region === key ? 'selected' : ''}" 
                                 onclick="updateFormData('region', '${key}')">
                                <div class="region-name">${region.name}</div>
                                <div class="region-info">
                                    <p>å¹³å‡å˜ä¾¡: Â¥${region.avgPrice.toLocaleString()}/æ³Š</p>
                                    <p>ç¨¼åƒç‡: ${region.occupancy}%</p>
                                    <p>${region.description}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="navigation">
                        <div></div>
                        <button class="nav-button primary" onclick="nextStep()" ${!canProceed() ? 'disabled' : ''}>
                            æ¬¡ã¸
                        </button>
                    </div>
                </div>
            `;
        }

        function renderOperationTypeSelection() {
            return `
                <div class="form-section">
                    <h2 class="section-title">é‹å–¶å½¢æ…‹ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
                    <div class="option-grid">
                        ${Object.entries(OPERATION_TYPES).map(([key, type]) => `
                            <div class="option-button ${appState.formData.operationType === key ? 'selected' : ''}" 
                                 onclick="updateFormData('operationType', '${key}')"
                                 style="grid-column: span 2; padding: 20px;">
                                <div style="font-size: 16px; font-weight: bold; margin-bottom: 8px;">
                                    ${type.name}
                                </div>
                                <div style="font-size: 14px; color: #666;">
                                    ${type.description}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="navigation">
                        <button class="nav-button" onclick="prevStep()">æˆ»ã‚‹</button>
                        <button class="nav-button primary" onclick="nextStep()" ${!canProceed() ? 'disabled' : ''}>
                            æ¬¡ã¸
                        </button>
                    </div>
                </div>
            `;
        }

        function renderPropertyInfo() {
            const propertyType = PROPERTY_TYPES[appState.formData.propertyType];
            let areaOptions = '';
            
            if (propertyType) {
                const areas = [];
                for (let i = propertyType.minArea; i <= propertyType.maxArea; i += 5) {
                    areas.push(i);
                }
                areaOptions = areas.map(area => `
                    <div class="option-button ${appState.formData.area === area.toString() ? 'selected' : ''}" 
                         onclick="updateFormData('area', '${area}'); updateFormData('customArea', '');">
                        ${area}ã¡
                    </div>
                `).join('');
            }

            return `
                <div class="form-section">
                    <h2 class="section-title">ç‰©ä»¶æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
                    
                    <div class="form-group">
                        <label class="form-label">ç‰©ä»¶ã‚¿ã‚¤ãƒ—</label>
                        <div class="option-grid">
                            ${Object.entries(PROPERTY_TYPES).map(([key, type]) => `
                                <div class="option-button ${appState.formData.propertyType === key ? 'selected' : ''}" 
                                     onclick="updateFormData('propertyType', '${key}')">
                                    <div style="font-weight: bold;">${type.name}</div>
                                    <div style="font-size: 12px; color: #666;">${type.capacity}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    ${propertyType ? `
                        <div class="form-group">
                            <label class="form-label">é¢ç©</label>
                            <div class="option-grid">
                                ${areaOptions}
                            </div>
                            <input type="number" class="form-input" placeholder="ã‚«ã‚¹ã‚¿ãƒ é¢ç©ã‚’å…¥åŠ›ï¼ˆã¡ï¼‰" 
                                   value="${appState.formData.customArea}" 
                                   oninput="updateFormData('customArea', this.value); updateFormData('area', '');"
                                   style="margin-top: 10px;">
                        </div>
                    ` : ''}

                    <div class="form-group">
                        <label class="form-label">æ°‘æ³Šé‹å–¶å½¢æ…‹</label>
                        <div class="option-grid">
                            ${Object.entries(MINPAKU_LAWS).map(([key, law]) => `
                                <div class="option-button ${appState.formData.minpakuLaw === key ? 'selected' : ''}" 
                                     onclick="updateFormData('minpakuLaw', '${key}')"
                                     style="grid-column: span 2;">
                                    <div style="font-weight: bold;">${law.name}</div>
                                    <div style="font-size: 12px; color: #666;">${law.description}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="navigation">
                        <button class="nav-button" onclick="prevStep()">æˆ»ã‚‹</button>
                        <button class="nav-button primary" onclick="nextStep()" ${!canProceed() ? 'disabled' : ''}>
                            æ¬¡ã¸
                        </button>
                    </div>
                </div>
            `;
        }

        function renderCapacitySelection() {
            const area = parseInt(appState.formData.area || appState.formData.customArea);
            const maxCapacity = Math.min(Math.floor(area / 8), 8); // 8ã¡/äººã€æœ€å¤§8å
            const capacityOptions = [];
            for (let i = 1; i <= maxCapacity; i++) {
                capacityOptions.push(i);
            }

            return `
                <div class="form-section">
                    <h2 class="section-title">åå®¹äººæ•°ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
                    
                    <div class="market-info">
                        <h4>é¢ç©: ${area}ã¡</h4>
                        <p>æ¨å¥¨åå®¹äººæ•°: 1-${maxCapacity}å</p>
                        <p>â€» 2æ®µãƒ™ãƒƒãƒ‰ã‚„ã‚½ãƒ•ã‚¡ãƒ™ãƒƒãƒ‰ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§åå®¹äººæ•°ã‚’å¢—ã‚„ã™ã“ã¨ãŒã§ãã¾ã™</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">åå®¹äººæ•°</label>
                        <div class="option-grid">
                            ${capacityOptions.map(capacity => `
                                <div class="option-button ${appState.formData.capacity === capacity.toString() ? 'selected' : ''}" 
                                     onclick="updateFormData('capacity', '${capacity}')">
                                    ${capacity}å
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="navigation">
                        <button class="nav-button" onclick="prevStep()">æˆ»ã‚‹</button>
                        <button class="nav-button primary" onclick="nextStep()" ${!canProceed() ? 'disabled' : ''}>
                            æ¬¡ã¸
                        </button>
                    </div>
                </div>
            `;
        }

        function renderInvestmentAmount() {
            return `
                <div class="form-section">
                    <h2 class="section-title">æŠ•è³‡é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
                    
                    ${appState.formData.operationType === 'rental' ? `
                        <div class="form-group">
                            <label class="form-label">æœˆé¡å®¶è³ƒï¼ˆå††ï¼‰</label>
                            <input type="number" class="form-input" placeholder="ä¾‹: 120000" 
                                   value="${appState.formData.monthlyRent}" 
                                   oninput="updateFormData('monthlyRent', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³è²»ç”¨ï¼ˆä¸‡å††ï¼‰</label>
                            <input type="number" class="form-input" placeholder="ä¾‹: 400" 
                                   value="${appState.formData.renovationCost}" 
                                   oninput="updateFormData('renovationCost', this.value)">
                        </div>
                    ` : `
                        <div class="form-group">
                            <label class="form-label">ç‰©ä»¶è³¼å…¥ä¾¡æ ¼ï¼ˆä¸‡å††ï¼‰</label>
                            <input type="number" class="form-input" placeholder="ä¾‹: 2000" 
                                   value="${appState.formData.purchasePrice}" 
                                   oninput="updateFormData('purchasePrice', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³è²»ç”¨ï¼ˆä¸‡å††ï¼‰</label>
                            <input type="number" class="form-input" placeholder="ä¾‹: 400" 
                                   value="${appState.formData.renovationCost}" 
                                   oninput="updateFormData('renovationCost', this.value)">
                        </div>
                    `}

                    <div class="navigation">
                        <button class="nav-button" onclick="prevStep()">æˆ»ã‚‹</button>
                        <button class="nav-button primary" onclick="nextStep()" ${!canProceed() ? 'disabled' : ''}>
                            æ¬¡ã¸
                        </button>
                    </div>
                </div>
            `;
        }

        function renderInitialCosts() {
            return `
                <div class="form-section">
                    <h2 class="section-title">åˆæœŸè²»ç”¨ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
                    
                    <div style="margin-bottom: 20px; color: #666; font-size: 14px;">
                        â€» æœˆé¡å®¶è³ƒã«åŸºã¥ã„ã¦ç›¸å ´å€¤ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¦ã„ã¾ã™
                    </div>

                    <div class="form-group">
                        <label class="form-label">æ•·é‡‘ï¼ˆå††ï¼‰</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="ç›¸å ´: ${appState.formData.monthlyRent ? parseInt(appState.formData.monthlyRent) * 2 : 0}å††ï¼ˆå®¶è³ƒã®2ãƒ¶æœˆåˆ†ï¼‰" 
                               value="${appState.formData.deposit}" 
                               oninput="updateFormData('deposit', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ç¤¼é‡‘ï¼ˆå††ï¼‰</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="ç›¸å ´: ${appState.formData.monthlyRent ? parseInt(appState.formData.monthlyRent) : 0}å††ï¼ˆå®¶è³ƒã®1ãƒ¶æœˆåˆ†ï¼‰" 
                               value="${appState.formData.keyMoney}" 
                               oninput="updateFormData('keyMoney', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ä»²ä»‹æ‰‹æ•°æ–™ï¼ˆå††ï¼‰</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="ç›¸å ´: ${appState.formData.monthlyRent ? parseInt(appState.formData.monthlyRent) : 0}å††ï¼ˆå®¶è³ƒã®1ãƒ¶æœˆåˆ†ï¼‰" 
                               value="${appState.formData.brokerFee}" 
                               oninput="updateFormData('brokerFee', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ç©ºå®¶è³ƒæœŸé–“ï¼ˆå††ï¼‰</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="ç›¸å ´: ${appState.formData.monthlyRent ? parseInt(appState.formData.monthlyRent) : 0}å††ï¼ˆæº–å‚™æœŸé–“ã®å®¶è³ƒï¼‰" 
                               value="${appState.formData.vacantRent}" 
                               oninput="updateFormData('vacantRent', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ç«ç½ä¿é™ºï¼ˆå††ï¼‰</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="ç›¸å ´: 20000å††ï¼ˆå¹´é–“ä¿é™ºæ–™ï¼‰" 
                               value="${appState.formData.insurance}" 
                               oninput="updateFormData('insurance', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ä¿è¨¼ä¼šç¤¾ï¼ˆå††ï¼‰</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="ç›¸å ´: ${appState.formData.monthlyRent ? Math.round(parseInt(appState.formData.monthlyRent) * 0.5) : 0}å††ï¼ˆå®¶è³ƒã®0.5ãƒ¶æœˆåˆ†ï¼‰" 
                               value="${appState.formData.guarantee}" 
                               oninput="updateFormData('guarantee', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ãã®ä»–è²»ç”¨ï¼ˆå††ï¼‰</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="ç›¸å ´: 50000å††ï¼ˆéµäº¤æ›ã€ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ç­‰ï¼‰" 
                               value="${appState.formData.otherCosts}" 
                               oninput="updateFormData('otherCosts', this.value)">
                    </div>

                    <div class="navigation">
                        <button class="nav-button" onclick="prevStep()">æˆ»ã‚‹</button>
                        <button class="nav-button primary" onclick="nextStep()" ${!canProceed() ? 'disabled' : ''}>
                            æ¬¡ã¸
                        </button>
                    </div>
                </div>
            `;
        }

        function renderConfirmation() {
            const region = REGIONS[appState.formData.region];
            const operationType = OPERATION_TYPES[appState.formData.operationType];
            const minpakuLaw = MINPAKU_LAWS[appState.formData.minpakuLaw];
            const area = appState.formData.area || appState.formData.customArea;

            const totalInitialCosts = appState.formData.operationType === 'rental' 
                ? (parseInt(appState.formData.deposit || 0) + parseInt(appState.formData.keyMoney || 0) + 
                   parseInt(appState.formData.brokerFee || 0) + parseInt(appState.formData.vacantRent || 0) + 
                   parseInt(appState.formData.insurance || 0) + parseInt(appState.formData.guarantee || 0) + 
                   parseInt(appState.formData.otherCosts || 0))
                : 0;

            return `
                <div class="form-section">
                    <h2 class="section-title">å…¥åŠ›å†…å®¹ã®ç¢ºèª</h2>
                    
                    <table class="summary-table">
                        <tbody>
                            <tr><th>åœ°åŸŸ</th><td>${region.name}</td></tr>
                            <tr><th>é‹å–¶å½¢æ…‹</th><td>${operationType.name}</td></tr>
                            <tr><th>ç‰©ä»¶ã‚¿ã‚¤ãƒ—</th><td>${appState.formData.propertyType}</td></tr>
                            <tr><th>é¢ç©</th><td>${area}ã¡</td></tr>
                            <tr><th>åå®¹äººæ•°</th><td>${appState.formData.capacity}å</td></tr>
                            <tr><th>æ°‘æ³Šæ³•</th><td>${minpakuLaw.name}ï¼ˆ${minpakuLaw.limit}ï¼‰</td></tr>
                            ${appState.formData.operationType === 'rental' ? `
                                <tr><th>æœˆé¡å®¶è³ƒ</th><td>${parseInt(appState.formData.monthlyRent).toLocaleString()}å††</td></tr>
                            ` : `
                                <tr><th>ç‰©ä»¶è³¼å…¥ä¾¡æ ¼</th><td>${parseInt(appState.formData.purchasePrice).toLocaleString()}ä¸‡å††</td></tr>
                            `}
                            <tr><th>ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³è²»ç”¨</th><td>${parseInt(appState.formData.renovationCost).toLocaleString()}ä¸‡å††</td></tr>
                            ${appState.formData.operationType === 'rental' ? `
                                <tr><th>åˆæœŸè²»ç”¨åˆè¨ˆ</th><td>${totalInitialCosts.toLocaleString()}å††</td></tr>
                            ` : ''}
                        </tbody>
                    </table>

                    <div class="navigation">
                        <button class="nav-button" onclick="prevStep()">æˆ»ã‚‹</button>
                        <button class="nav-button primary" onclick="calculateResults()">
                            çµæœã‚’è¨ˆç®—
                        </button>
                    </div>
                </div>
            `;
        }

        function renderCompletion() {
            return `
                <div class="form-section">
                    <div class="completion-message">
                        <div class="completion-icon">ğŸ‰</div>
                        <h2 class="completion-title">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ï¼</h2>
                        <p class="completion-text">
                            è©³ç´°ãªçµæœã¯å…¬å¼LINEã§ç¢ºèªã§ãã¾ã™ã€‚<br/>
                            ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰å…¬å¼LINEã«ç™»éŒ²ã—ã€<br/>
                            ã€Œçµæœã€ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ï¼
                        </p>
                        
                        <div>
                            <a href="${CONFIG.LINE_URL}" target="_blank" rel="noopener noreferrer" class="line-button">
                                ğŸ“± å…¬å¼LINEã«ç™»éŒ²ã™ã‚‹
                            </a>
                        </div>
                        
                        <div style="margin-top: 20px; font-size: 14px; color: #666;">
                            <p>ğŸ“‹ çµæœã®å—ã‘å–ã‚Šæ–¹æ³•:</p>
                            <p>1. ä¸Šã®ãƒœã‚¿ãƒ³ã‹ã‚‰å…¬å¼LINEã«ç™»éŒ²</p>
                            <p>2. LINEã§ã€Œçµæœã€ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡</p>
                            <p>3. è©³ç´°ãªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœãŒå±Šãã¾ã™ï¼</p>
                        </div>

                        <button class="restart-button" onclick="restart()" style="margin-top: 30px;">
                            æ–°ã—ã„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                        </button>
                    </div>
                </div>
            `;
        }

        // LINE Botçµæœè¡¨ç¤ºã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function showLineBotResult() {
            const results = localStorage.getItem('minpakuSimulationResults');
            const message = localStorage.getItem('lineBotMessage');
            
            if (results && message) {
                alert(message);
                return true;
            } else {
                alert('ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                return false;
            }
        }

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        function initializeApp() {
            console.log('Initializing Minpaku Simulator...');
            renderApp();
            
            // LINE Botçµæœè¡¨ç¤ºã®ãƒ†ã‚¹ãƒˆç”¨
            window.showLineBotResult = showLineBotResult;
            console.log('LINE Botçµæœè¡¨ç¤ºãƒ†ã‚¹ãƒˆ: window.showLineBotResult()');
        }

        // DOMãŒèª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>

