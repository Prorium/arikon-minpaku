<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>有村昆の民泊塾 - 民泊シミュレーター</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'ヒラギノ角ゴシック', 'Yu Gothic', 'メイリオ', sans-serif;
            background: white;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .logo {
            max-width: 400px;
            height: auto;
            margin-bottom: 20px;
        }

        .title {
            font-size: 28px;
            font-weight: bold;
            color: #d2691e;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 16px;
            color: #666;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .step {
            display: flex;
            align-items: center;
            margin: 5px;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #ddd;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 8px;
        }

        .step.active .step-number {
            background: #d2691e;
        }

        .step.completed .step-number {
            background: #28a745;
        }

        .step-text {
            font-size: 14px;
            color: #666;
        }

        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: #d2691e;
            margin-bottom: 20px;
            text-align: center;
        }

        .region-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .region-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .region-card:hover {
            border-color: #d2691e;
            transform: translateY(-2px);
        }

        .region-card.selected {
            border-color: #28a745;
            background: #f8fff8;
        }

        .region-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .region-info {
            font-size: 14px;
            color: #666;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #d2691e;
        }

        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .option-button {
            background: white;
            border: 2px solid #ddd;
            border-radius: 6px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .option-button:hover {
            border-color: #d2691e;
        }

        .option-button.selected {
            border-color: #28a745;
            background: #f8fff8;
            color: #28a745;
            font-weight: bold;
        }

        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }

        .button:hover {
            background: #0056b3;
        }

        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .button.secondary {
            background: #6c757d;
        }

        .button.secondary:hover {
            background: #545b62;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .nav-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .nav-button:hover {
            background: #545b62;
        }

        .nav-button.primary {
            background: #007bff;
        }

        .nav-button.primary:hover {
            background: #0056b3;
        }

        .nav-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .summary-table th,
        .summary-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .summary-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        .summary-table td {
            color: #666;
        }

        .completion-message {
            text-align: center;
            padding: 40px 20px;
        }

        .completion-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .completion-title {
            font-size: 28px;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 15px;
        }

        .completion-text {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.8;
        }

        .line-button {
            background: #00c300;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
        }

        .line-button:hover {
            background: #00a000;
        }

        .restart-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
            margin: 10px;
        }

        .restart-button:hover {
            background: #0056b3;
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px 0;
            color: #666;
            font-size: 14px;
            border-top: 1px solid #eee;
        }

        .hidden {
            display: none;
        }

        .auto-input {
            background: #e8f5e8;
            border-color: #28a745;
        }

        .market-info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .market-info h4 {
            color: #0066cc;
            margin-bottom: 10px;
        }

        .market-info p {
            font-size: 14px;
            color: #333;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .region-grid {
                grid-template-columns: 1fr;
            }

            .option-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .step-indicator {
                flex-direction: column;
                align-items: center;
            }

            .navigation {
                flex-direction: column;
                gap: 10px;
            }

            .nav-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="logo.png" alt="有村昆の民泊塾" class="logo" onerror="this.style.display='none'">
            <h1 class="title">有村昆の民泊塾</h1>
            <p class="subtitle">民泊投資シミュレーター</p>
        </div>

        <div class="step-indicator" id="stepIndicator">
            <!-- ステップインジケーターはJavaScriptで動的に生成 -->
        </div>

        <div id="app">
            <!-- アプリケーションコンテンツはReactで動的に生成 -->
        </div>

        <div class="footer">
            <p>&copy; 2024 有村昆の民泊塾. All rights reserved.</p>
        </div>
    </div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        // 設定
        const CONFIG = {
            BACKEND_URL: 'https://arikon-minpaku.onrender.com',
            LINE_URL: 'https://lin.ee/VzUHQsm'
        };

        // データ定義
        const REGIONS = {
            tokyo: { name: '東京都', avgPrice: 8000, occupancy: 75, description: '高収益エリア、観光客多数' },
            osaka: { name: '大阪府', avgPrice: 6500, occupancy: 70, description: '関西の中心地、インバウンド人気' },
            kyoto: { name: '京都府', avgPrice: 7000, occupancy: 80, description: '観光地として安定した需要' },
            kanagawa: { name: '神奈川県', avgPrice: 7500, occupancy: 65, description: '東京近郊、アクセス良好' },
            aichi: { name: '愛知県', avgPrice: 5500, occupancy: 60, description: '中部地方の中心地' },
            fukuoka: { name: '福岡県', avgPrice: 5000, occupancy: 65, description: '九州の玄関口、成長エリア' }
        };

        const OPERATION_TYPES = {
            rental: { name: '転貸（賃貸物件で民泊運営）', description: '賃貸物件を借りて民泊運営' },
            purchase: { name: '購入（物件購入して民泊運営）', description: '物件を購入して民泊運営' }
        };

        const PROPERTY_TYPES = {
            '1R': { name: '1R', capacity: '1-2名', minArea: 15, maxArea: 25 },
            '1K': { name: '1K', capacity: '1-2名', minArea: 20, maxArea: 30 },
            '1DK': { name: '1DK', capacity: '2-3名', minArea: 25, maxArea: 35 },
            '1LDK': { name: '1LDK', capacity: '2-4名', minArea: 35, maxArea: 55 },
            '2K': { name: '2K', capacity: '3-4名', minArea: 35, maxArea: 50 },
            '2DK': { name: '2DK', capacity: '3-5名', minArea: 40, maxArea: 60 },
            '2LDK': { name: '2LDK', capacity: '4-6名', minArea: 50, maxArea: 80 },
            '3LDK': { name: '3LDK', capacity: '6-8名', minArea: 70, maxArea: 120 }
        };

        const MINPAKU_LAWS = {
            shinpo: { name: '民泊新法対応', limit: '180日制限あり', description: '年間営業日数180日まで' },
            ryokan: { name: '旅館業法', limit: '制限なし', description: '年間営業日数制限なし' },
            tokku: { name: '特区民泊', limit: '制限なし', description: '年間営業日数制限なし' }
        };

        // グローバル状態
        let appState = {
            currentStep: 1,
            formData: {
                region: '',
                operationType: '',
                propertyType: '',
                area: '',
                customArea: '',
                capacity: '',
                minpakuLaw: '',
                monthlyRent: '',
                purchasePrice: '',
                renovationCost: '',
                deposit: '',
                keyMoney: '',
                brokerFee: '',
                vacantRent: '',
                insurance: '',
                guarantee: '',
                otherCosts: ''
            }
        };

        // ステップ定義
        function getSteps() {
            return appState.formData.operationType === 'rental' ? [
                { id: 1, title: '地域選択' },
                { id: 2, title: '運営形態' },
                { id: 3, title: '物件情報' },
                { id: 4, title: '収容人数' },
                { id: 5, title: '投資金額' },
                { id: 6, title: '初期費用' },
                { id: 7, title: '確認・計算' }
            ] : [
                { id: 1, title: '地域選択' },
                { id: 2, title: '運営形態' },
                { id: 3, title: '物件情報' },
                { id: 4, title: '収容人数' },
                { id: 5, title: '投資金額' },
                { id: 6, title: '確認・計算' }
            ];
        }

        // ステップインジケーター更新
        function updateStepIndicator() {
            const indicator = document.getElementById('stepIndicator');
            if (!indicator) return;

            const steps = getSteps();
            indicator.innerHTML = steps.map(step => `
                <div class="step ${step.id === appState.currentStep ? 'active' : step.id < appState.currentStep ? 'completed' : ''}">
                    <div class="step-number">${step.id}</div>
                    <div class="step-text">${step.title}</div>
                </div>
            `).join('');
        }

        // フォームデータ更新
        function updateFormData(field, value) {
            appState.formData[field] = value;
            
            // 月額家賃が変更された場合、初期費用を自動計算
            if (field === 'monthlyRent' && value) {
                const rent = parseInt(value);
                appState.formData.deposit = rent * 2; // 敷金2ヶ月
                appState.formData.keyMoney = rent; // 礼金1ヶ月
                appState.formData.brokerFee = rent; // 仲介手数料1ヶ月
                appState.formData.vacantRent = rent; // 空家賃1ヶ月
                appState.formData.insurance = 20000; // 火災保険
                appState.formData.guarantee = Math.round(rent * 0.5); // 保証会社0.5ヶ月
                appState.formData.otherCosts = 50000; // その他費用
            }
            
            renderApp();
        }

        // ナビゲーション
        function nextStep() {
            const steps = getSteps();
            if (appState.currentStep < steps.length) {
                appState.currentStep++;
                renderApp();
            }
        }

        function prevStep() {
            if (appState.currentStep > 1) {
                appState.currentStep--;
                renderApp();
            }
        }

        // 進行可能チェック
        function canProceed() {
            const { formData, currentStep } = appState;
            switch (currentStep) {
                case 1: return formData.region;
                case 2: return formData.operationType;
                case 3: return formData.propertyType && (formData.area || formData.customArea) && formData.minpakuLaw;
                case 4: return formData.capacity;
                case 5: 
                    if (formData.operationType === 'rental') {
                        return formData.monthlyRent && formData.renovationCost;
                    } else {
                        return formData.purchasePrice && formData.renovationCost;
                    }
                case 6: 
                    if (formData.operationType === 'rental') {
                        return true; // 初期費用は任意
                    } else {
                        return true; // 購入の場合は確認画面
                    }
                default: return true;
            }
        }

        // 結果計算
        function calculateResults() {
            const { formData } = appState;
            const region = REGIONS[formData.region];
            const area = parseInt(formData.area || formData.customArea);
            const capacity = parseInt(formData.capacity);
            const renovationCost = parseInt(formData.renovationCost) * 10000;
            
            let monthlyRevenue, totalInitialCost, monthlyProfit, roi, paybackPeriod;

            // 月間売上計算
            const dailyRate = region.avgPrice * capacity;
            const monthlyOccupancy = region.occupancy / 100;
            const operatingDays = formData.minpakuLaw === 'shinpo' ? 15 : 30; // 月間営業日数
            monthlyRevenue = dailyRate * operatingDays * monthlyOccupancy;

            // 月間経費
            const monthlyExpenses = formData.operationType === 'rental' 
                ? parseInt(formData.monthlyRent || 0) + 30000 // 家賃 + 管理費等
                : 50000; // 購入の場合は管理費等のみ

            // 初期費用計算
            if (formData.operationType === 'rental') {
                const deposit = parseInt(formData.deposit || 0);
                const keyMoney = parseInt(formData.keyMoney || 0);
                const brokerFee = parseInt(formData.brokerFee || 0);
                const vacantRent = parseInt(formData.vacantRent || 0);
                const insurance = parseInt(formData.insurance || 0);
                const guarantee = parseInt(formData.guarantee || 0);
                const otherCosts = parseInt(formData.otherCosts || 0);
                
                totalInitialCost = renovationCost + deposit + keyMoney + brokerFee + vacantRent + insurance + guarantee + otherCosts;
            } else {
                const purchasePrice = parseInt(formData.purchasePrice) * 10000;
                totalInitialCost = purchasePrice + renovationCost;
            }

            monthlyProfit = monthlyRevenue - monthlyExpenses;
            roi = (monthlyProfit * 12 / totalInitialCost) * 100;
            paybackPeriod = totalInitialCost / monthlyProfit;

            // シミュレーション結果をローカルストレージに保存
            const results = {
                region: region.name,
                operationType: OPERATION_TYPES[formData.operationType].name,
                propertyType: formData.propertyType,
                area: area,
                capacity: capacity,
                minpakuLaw: MINPAKU_LAWS[formData.minpakuLaw].name,
                monthlyRevenue: Math.round(monthlyRevenue),
                monthlyExpenses: monthlyExpenses,
                monthlyProfit: Math.round(monthlyProfit),
                totalInitialCost: totalInitialCost,
                roi: Math.round(roi * 10) / 10,
                paybackPeriod: Math.round(paybackPeriod * 10) / 10,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('minpakuSimulationResults', JSON.stringify(results));
            
            // LINE Bot用のWebhookを送信
            sendToLineBot(results);
            
            appState.currentStep = getSteps().length + 1; // 完了画面へ
            renderApp();
        }

        // LINE Bot用のWebhook送信
        function sendToLineBot(results) {
            // 簡易的なLINE Bot機能をシミュレート
            const resultMessage = `
🏠 民泊シミュレーション結果

📍 地域: ${results.region}
🏢 運営形態: ${results.operationType}
🏠 物件: ${results.propertyType} (${results.area}㎡)
👥 収容人数: ${results.capacity}名
📋 民泊法: ${results.minpakuLaw}

💰 収益予測:
・月間売上: ¥${results.monthlyRevenue.toLocaleString()}
・月間経費: ¥${results.monthlyExpenses.toLocaleString()}
・月間利益: ¥${results.monthlyProfit.toLocaleString()}

📊 投資指標:
・初期投資: ¥${results.totalInitialCost.toLocaleString()}
・ROI: ${results.roi}%
・投資回収期間: ${results.paybackPeriod}ヶ月

※ この結果は概算です。実際の収益は市場状況により変動します。
            `;
            
            // ローカルストレージにLINE Bot用メッセージを保存
            localStorage.setItem('lineBotMessage', resultMessage);
            
            // 実際のLINE Bot APIへの送信（将来の実装用）
            try {
                fetch(CONFIG.BACKEND_URL + '/webhook', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: 'simulation_result',
                        data: results
                    })
                }).catch(err => console.log('Backend not available:', err));
            } catch (err) {
                console.log('Backend not available:', err);
            }
        }

        // アプリ再開
        function restart() {
            appState.currentStep = 1;
            appState.formData = {
                region: '',
                operationType: '',
                propertyType: '',
                area: '',
                customArea: '',
                capacity: '',
                minpakuLaw: '',
                monthlyRent: '',
                purchasePrice: '',
                renovationCost: '',
                deposit: '',
                keyMoney: '',
                brokerFee: '',
                vacantRent: '',
                insurance: '',
                guarantee: '',
                otherCosts: ''
            };
            renderApp();
        }

        // レンダリング関数
        function renderApp() {
            updateStepIndicator();
            
            const appElement = document.getElementById('app');
            if (!appElement) return;

            let content = '';
            
            switch (appState.currentStep) {
                case 1:
                    content = renderRegionSelection();
                    break;
                case 2:
                    content = renderOperationTypeSelection();
                    break;
                case 3:
                    content = renderPropertyInfo();
                    break;
                case 4:
                    content = renderCapacitySelection();
                    break;
                case 5:
                    content = renderInvestmentAmount();
                    break;
                case 6:
                    if (appState.formData.operationType === 'rental') {
                        content = renderInitialCosts();
                    } else {
                        content = renderConfirmation();
                    }
                    break;
                case 7:
                    content = renderConfirmation();
                    break;
                default:
                    content = renderCompletion();
                    break;
            }
            
            appElement.innerHTML = content;
        }

        // 各ステップのレンダリング関数
        function renderRegionSelection() {
            return `
                <div class="form-section">
                    <h2 class="section-title">地域を選択してください</h2>
                    <div class="region-grid">
                        ${Object.entries(REGIONS).map(([key, region]) => `
                            <div class="region-card ${appState.formData.region === key ? 'selected' : ''}" 
                                 onclick="updateFormData('region', '${key}')">
                                <div class="region-name">${region.name}</div>
                                <div class="region-info">
                                    <p>平均単価: ¥${region.avgPrice.toLocaleString()}/泊</p>
                                    <p>稼働率: ${region.occupancy}%</p>
                                    <p>${region.description}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="navigation">
                        <div></div>
                        <button class="nav-button primary" onclick="nextStep()" ${!canProceed() ? 'disabled' : ''}>
                            次へ
                        </button>
                    </div>
                </div>
            `;
        }

        function renderOperationTypeSelection() {
            return `
                <div class="form-section">
                    <h2 class="section-title">運営形態を選択してください</h2>
                    <div class="option-grid">
                        ${Object.entries(OPERATION_TYPES).map(([key, type]) => `
                            <div class="option-button ${appState.formData.operationType === key ? 'selected' : ''}" 
                                 onclick="updateFormData('operationType', '${key}')"
                                 style="grid-column: span 2; padding: 20px;">
                                <div style="font-size: 16px; font-weight: bold; margin-bottom: 8px;">
                                    ${type.name}
                                </div>
                                <div style="font-size: 14px; color: #666;">
                                    ${type.description}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="navigation">
                        <button class="nav-button" onclick="prevStep()">戻る</button>
                        <button class="nav-button primary" onclick="nextStep()" ${!canProceed() ? 'disabled' : ''}>
                            次へ
                        </button>
                    </div>
                </div>
            `;
        }

        function renderPropertyInfo() {
            const propertyType = PROPERTY_TYPES[appState.formData.propertyType];
            let areaOptions = '';
            
            if (propertyType) {
                const areas = [];
                for (let i = propertyType.minArea; i <= propertyType.maxArea; i += 5) {
                    areas.push(i);
                }
                areaOptions = areas.map(area => `
                    <div class="option-button ${appState.formData.area === area.toString() ? 'selected' : ''}" 
                         onclick="updateFormData('area', '${area}'); updateFormData('customArea', '');">
                        ${area}㎡
                    </div>
                `).join('');
            }

            return `
                <div class="form-section">
                    <h2 class="section-title">物件情報を入力してください</h2>
                    
                    <div class="form-group">
                        <label class="form-label">物件タイプ</label>
                        <div class="option-grid">
                            ${Object.entries(PROPERTY_TYPES).map(([key, type]) => `
                                <div class="option-button ${appState.formData.propertyType === key ? 'selected' : ''}" 
                                     onclick="updateFormData('propertyType', '${key}')">
                                    <div style="font-weight: bold;">${type.name}</div>
                                    <div style="font-size: 12px; color: #666;">${type.capacity}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    ${propertyType ? `
                        <div class="form-group">
                            <label class="form-label">面積</label>
                            <div class="option-grid">
                                ${areaOptions}
                            </div>
                            <input type="number" class="form-input" placeholder="カスタム面積を入力（㎡）" 
                                   value="${appState.formData.customArea}" 
                                   oninput="updateFormData('customArea', this.value); updateFormData('area', '');"
                                   style="margin-top: 10px;">
                        </div>
                    ` : ''}

                    <div class="form-group">
                        <label class="form-label">民泊運営形態</label>
                        <div class="option-grid">
                            ${Object.entries(MINPAKU_LAWS).map(([key, law]) => `
                                <div class="option-button ${appState.formData.minpakuLaw === key ? 'selected' : ''}" 
                                     onclick="updateFormData('minpakuLaw', '${key}')"
                                     style="grid-column: span 2;">
                                    <div style="font-weight: bold;">${law.name}</div>
                                    <div style="font-size: 12px; color: #666;">${law.description}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="navigation">
                        <button class="nav-button" onclick="prevStep()">戻る</button>
                        <button class="nav-button primary" onclick="nextStep()" ${!canProceed() ? 'disabled' : ''}>
                            次へ
                        </button>
                    </div>
                </div>
            `;
        }

        function renderCapacitySelection() {
            const area = parseInt(appState.formData.area || appState.formData.customArea);
            const maxCapacity = Math.min(Math.floor(area / 8), 8); // 8㎡/人、最大8名
            const capacityOptions = [];
            for (let i = 1; i <= maxCapacity; i++) {
                capacityOptions.push(i);
            }

            return `
                <div class="form-section">
                    <h2 class="section-title">収容人数を選択してください</h2>
                    
                    <div class="market-info">
                        <h4>面積: ${area}㎡</h4>
                        <p>推奨収容人数: 1-${maxCapacity}名</p>
                        <p>※ 2段ベッドやソファベッドを活用することで収容人数を増やすことができます</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">収容人数</label>
                        <div class="option-grid">
                            ${capacityOptions.map(capacity => `
                                <div class="option-button ${appState.formData.capacity === capacity.toString() ? 'selected' : ''}" 
                                     onclick="updateFormData('capacity', '${capacity}')">
                                    ${capacity}名
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="navigation">
                        <button class="nav-button" onclick="prevStep()">戻る</button>
                        <button class="nav-button primary" onclick="nextStep()" ${!canProceed() ? 'disabled' : ''}>
                            次へ
                        </button>
                    </div>
                </div>
            `;
        }

        function renderInvestmentAmount() {
            return `
                <div class="form-section">
                    <h2 class="section-title">投資金額を入力してください</h2>
                    
                    ${appState.formData.operationType === 'rental' ? `
                        <div class="form-group">
                            <label class="form-label">月額家賃（円）</label>
                            <input type="number" class="form-input" placeholder="例: 120000" 
                                   value="${appState.formData.monthlyRent}" 
                                   oninput="updateFormData('monthlyRent', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">リノベーション費用（万円）</label>
                            <input type="number" class="form-input" placeholder="例: 400" 
                                   value="${appState.formData.renovationCost}" 
                                   oninput="updateFormData('renovationCost', this.value)">
                        </div>
                    ` : `
                        <div class="form-group">
                            <label class="form-label">物件購入価格（万円）</label>
                            <input type="number" class="form-input" placeholder="例: 2000" 
                                   value="${appState.formData.purchasePrice}" 
                                   oninput="updateFormData('purchasePrice', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">リノベーション費用（万円）</label>
                            <input type="number" class="form-input" placeholder="例: 400" 
                                   value="${appState.formData.renovationCost}" 
                                   oninput="updateFormData('renovationCost', this.value)">
                        </div>
                    `}

                    <div class="navigation">
                        <button class="nav-button" onclick="prevStep()">戻る</button>
                        <button class="nav-button primary" onclick="nextStep()" ${!canProceed() ? 'disabled' : ''}>
                            次へ
                        </button>
                    </div>
                </div>
            `;
        }

        function renderInitialCosts() {
            return `
                <div class="form-section">
                    <h2 class="section-title">初期費用を入力してください</h2>
                    
                    <div style="margin-bottom: 20px; color: #666; font-size: 14px;">
                        ※ 月額家賃に基づいて相場値が自動入力されています
                    </div>

                    <div class="form-group">
                        <label class="form-label">敷金（円）</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="相場: ${appState.formData.monthlyRent ? parseInt(appState.formData.monthlyRent) * 2 : 0}円（家賃の2ヶ月分）" 
                               value="${appState.formData.deposit}" 
                               oninput="updateFormData('deposit', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">礼金（円）</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="相場: ${appState.formData.monthlyRent ? parseInt(appState.formData.monthlyRent) : 0}円（家賃の1ヶ月分）" 
                               value="${appState.formData.keyMoney}" 
                               oninput="updateFormData('keyMoney', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">仲介手数料（円）</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="相場: ${appState.formData.monthlyRent ? parseInt(appState.formData.monthlyRent) : 0}円（家賃の1ヶ月分）" 
                               value="${appState.formData.brokerFee}" 
                               oninput="updateFormData('brokerFee', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">空家賃期間（円）</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="相場: ${appState.formData.monthlyRent ? parseInt(appState.formData.monthlyRent) : 0}円（準備期間の家賃）" 
                               value="${appState.formData.vacantRent}" 
                               oninput="updateFormData('vacantRent', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">火災保険（円）</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="相場: 20000円（年間保険料）" 
                               value="${appState.formData.insurance}" 
                               oninput="updateFormData('insurance', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">保証会社（円）</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="相場: ${appState.formData.monthlyRent ? Math.round(parseInt(appState.formData.monthlyRent) * 0.5) : 0}円（家賃の0.5ヶ月分）" 
                               value="${appState.formData.guarantee}" 
                               oninput="updateFormData('guarantee', this.value)">
                    </div>

                    <div class="form-group">
                        <label class="form-label">その他費用（円）</label>
                        <input type="number" class="form-input auto-input" 
                               placeholder="相場: 50000円（鍵交換、クリーニング等）" 
                               value="${appState.formData.otherCosts}" 
                               oninput="updateFormData('otherCosts', this.value)">
                    </div>

                    <div class="navigation">
                        <button class="nav-button" onclick="prevStep()">戻る</button>
                        <button class="nav-button primary" onclick="nextStep()" ${!canProceed() ? 'disabled' : ''}>
                            次へ
                        </button>
                    </div>
                </div>
            `;
        }

        function renderConfirmation() {
            const region = REGIONS[appState.formData.region];
            const operationType = OPERATION_TYPES[appState.formData.operationType];
            const minpakuLaw = MINPAKU_LAWS[appState.formData.minpakuLaw];
            const area = appState.formData.area || appState.formData.customArea;

            const totalInitialCosts = appState.formData.operationType === 'rental' 
                ? (parseInt(appState.formData.deposit || 0) + parseInt(appState.formData.keyMoney || 0) + 
                   parseInt(appState.formData.brokerFee || 0) + parseInt(appState.formData.vacantRent || 0) + 
                   parseInt(appState.formData.insurance || 0) + parseInt(appState.formData.guarantee || 0) + 
                   parseInt(appState.formData.otherCosts || 0))
                : 0;

            return `
                <div class="form-section">
                    <h2 class="section-title">入力内容の確認</h2>
                    
                    <table class="summary-table">
                        <tbody>
                            <tr><th>地域</th><td>${region.name}</td></tr>
                            <tr><th>運営形態</th><td>${operationType.name}</td></tr>
                            <tr><th>物件タイプ</th><td>${appState.formData.propertyType}</td></tr>
                            <tr><th>面積</th><td>${area}㎡</td></tr>
                            <tr><th>収容人数</th><td>${appState.formData.capacity}名</td></tr>
                            <tr><th>民泊法</th><td>${minpakuLaw.name}（${minpakuLaw.limit}）</td></tr>
                            ${appState.formData.operationType === 'rental' ? `
                                <tr><th>月額家賃</th><td>${parseInt(appState.formData.monthlyRent).toLocaleString()}円</td></tr>
                            ` : `
                                <tr><th>物件購入価格</th><td>${parseInt(appState.formData.purchasePrice).toLocaleString()}万円</td></tr>
                            `}
                            <tr><th>リノベーション費用</th><td>${parseInt(appState.formData.renovationCost).toLocaleString()}万円</td></tr>
                            ${appState.formData.operationType === 'rental' ? `
                                <tr><th>初期費用合計</th><td>${totalInitialCosts.toLocaleString()}円</td></tr>
                            ` : ''}
                        </tbody>
                    </table>

                    <div class="navigation">
                        <button class="nav-button" onclick="prevStep()">戻る</button>
                        <button class="nav-button primary" onclick="calculateResults()">
                            結果を計算
                        </button>
                    </div>
                </div>
            `;
        }

        function renderCompletion() {
            return `
                <div class="form-section">
                    <div class="completion-message">
                        <div class="completion-icon">🎉</div>
                        <h2 class="completion-title">シミュレーション完了！</h2>
                        <p class="completion-text">
                            詳細な結果は公式LINEで確認できます。<br/>
                            下のボタンから公式LINEに登録し、<br/>
                            「結果」とメッセージを送信してください！
                        </p>
                        
                        <div>
                            <a href="${CONFIG.LINE_URL}" target="_blank" rel="noopener noreferrer" class="line-button">
                                📱 公式LINEに登録する
                            </a>
                        </div>
                        
                        <div style="margin-top: 20px; font-size: 14px; color: #666;">
                            <p>📋 結果の受け取り方法:</p>
                            <p>1. 上のボタンから公式LINEに登録</p>
                            <p>2. LINEで「結果」とメッセージを送信</p>
                            <p>3. 詳細なシミュレーション結果が届きます！</p>
                        </div>

                        <button class="restart-button" onclick="restart()" style="margin-top: 30px;">
                            新しいシミュレーション
                        </button>
                    </div>
                </div>
            `;
        }

        // LINE Bot結果表示のシミュレーション
        function showLineBotResult() {
            const results = localStorage.getItem('minpakuSimulationResults');
            const message = localStorage.getItem('lineBotMessage');
            
            if (results && message) {
                alert(message);
                return true;
            } else {
                alert('シミュレーション結果が見つかりません。まずシミュレーションを実行してください。');
                return false;
            }
        }

        // アプリケーション初期化
        function initializeApp() {
            console.log('Initializing Minpaku Simulator...');
            renderApp();
            
            // LINE Bot結果表示のテスト用
            window.showLineBotResult = showLineBotResult;
            console.log('LINE Bot結果表示テスト: window.showLineBotResult()');
        }

        // DOMが読み込まれた後にアプリケーションを初期化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>

